<!doctype html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Optimize Asynchronous Requests Using Asyncio and Aiohttp // Don&#39;t Watch, Listen</title>

    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
    <link rel="shortcut icon" href="/favicon.ico">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#242930">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Don't Watch, Listen">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.143.1">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Joshua Parsons" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.c27bdbde9ad2ae9022125bc5e927509b9d793611b5af72ea993b2ffa7ec0b838.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Optimize Asynchronous Requests Using Asyncio and Aiohttp">
  <meta name="twitter:description" content="Imagine you’re a librarian tasked with collecting book details from hundreds of libraries across the country. If you visit each library one by one, waiting for them to hand you the information before moving to the next, it could take days. But what if you could send out assistants to all libraries at once, letting them gather details simultaneously while you sip coffee? That’s the magic of asynchronous programming—doing many things at the same time without waiting around. In this tutorial, we’ll explore how to use Python’s asyncio and aiohttp libraries to make fast, efficient web requests, perfect for tasks like fetching stock market data or scraping websites. We’ll build from scratch, explain every concept, and optimize for speed, all while keeping it simple for beginners.">

    <meta property="og:url" content="http://localhost:1313/posts/optimize-asynchronous-requests-using-asyncio-and-aiohttp/">
  <meta property="og:site_name" content="Don&#39;t Watch, Listen">
  <meta property="og:title" content="Optimize Asynchronous Requests Using Asyncio and Aiohttp">
  <meta property="og:description" content="Imagine you’re a librarian tasked with collecting book details from hundreds of libraries across the country. If you visit each library one by one, waiting for them to hand you the information before moving to the next, it could take days. But what if you could send out assistants to all libraries at once, letting them gather details simultaneously while you sip coffee? That’s the magic of asynchronous programming—doing many things at the same time without waiting around. In this tutorial, we’ll explore how to use Python’s asyncio and aiohttp libraries to make fast, efficient web requests, perfect for tasks like fetching stock market data or scraping websites. We’ll build from scratch, explain every concept, and optimize for speed, all while keeping it simple for beginners.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-15T23:46:56-07:00">
    <meta property="article:modified_time" content="2025-03-15T23:46:56-07:00">


  </head>

  <body>
    
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let articles = document.querySelectorAll("#random-articles .random-article");
        let totalArticles = articles.length;
        let numToShow = Math.min(3, totalArticles);
        let selectedIndexes = new Set();
    
        
        while (selectedIndexes.size < numToShow) {
          let randomIndex = Math.floor(Math.random() * totalArticles);
          selectedIndexes.add(randomIndex);
        }
    
        
        selectedIndexes.forEach(index => {
          articles[index].style.display = "block";
        });
      });
    </script>
    
    <script>
      function randomizeBaseofArticles() {
        let articles = document.querySelectorAll("#random-articles-baseof .random-article-baseof");
        let totalArticles = articles.length;
        let numToShow = Math.min(3, totalArticles);
        let selectedIndexes = new Set();
    
        
        while (selectedIndexes.size < numToShow) {
          let randomIndex = Math.floor(Math.random() * totalArticles);
          selectedIndexes.add(randomIndex);
        }
    
        
        selectedIndexes.forEach(index => {
          articles[index].style.display = "block";
        });
      }
    
      document.addEventListener("DOMContentLoaded", randomizeBaseofArticles);
    </script>
    
    
    <script>
      function toggleSidebarSections() {
        let trendingSection = document.querySelector('.baseof-trending');
        let randomSection = document.querySelector('.baseof-random');
        let screenWidth = window.innerWidth;
    
        if (screenWidth >= 1929) {
          trendingSection.style.display = "none";
          randomSection.style.display = "none";
        } else {
          trendingSection.style.display = "block";
          randomSection.style.display = "block";
        }
      }
    
      
      document.addEventListener("DOMContentLoaded", toggleSidebarSections);
      window.addEventListener("resize", toggleSidebarSections);
    </script>
    
    
    <button id="styleToggle" class="style-toggle"></button>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/images/avatar.png" alt="Joshua Parsons" /></a>
      <span class="app-header-title">Don&#39;t Watch, Listen</span>
      <p>Don&#39;t Watch, Listen&#39;s Blog details extensive nuance in each discussion. Find a topic of interest to you in our categories below!</p>

      <nav class="category-nav">
        <h2>Categories</h2>
        <ul>
          
            <li><a href="/categories/3d-modeling/">3D Modeling (1)</a></li>
          
            <li><a href="/categories/math/science/">Math/Science (1)</a></li>
          
            <li><a href="/categories/politics/">Politics (6)</a></li>
          
            <li><a href="/categories/programming/">Programming (13)</a></li>
          
            <li><a href="/categories/psychology/">Psychology (1)</a></li>
          
        </ul>
      </nav>

    
    <div class="sidebar-section baseof-trending">
      <h2>Trending Articles</h2>
      <ul>
        
          <li><a href="/posts/optimize-asynchronous-requests-using-asyncio-and-aiohttp/">Optimize Asynchronous Requests Using Asyncio and Aiohttp</a></li>
        
          <li><a href="/posts/setting-up-the-yahoo-finance-api/">Setting Up the Yahoo Finance API</a></li>
        
          <li><a href="/posts/the-journalists-mic-a-security-oversight-waiting-for-disaster/">The Journalists Mic a Security Oversight Waiting for Disaster</a></li>
        
      </ul>
    </div>

    
    <div class="sidebar-section baseof-random">
      <h2>Random Articles</h2>
      <ul id="random-articles-baseof">
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/optimize-asynchronous-requests-using-asyncio-and-aiohttp/">Optimize Asynchronous Requests Using Asyncio and Aiohttp</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/setting-up-the-yahoo-finance-api/">Setting Up the Yahoo Finance API</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/the-journalists-mic-a-security-oversight-waiting-for-disaster/">The Journalists Mic a Security Oversight Waiting for Disaster</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/the-hidden-cost-of-always-being-right/">The Hidden Cost of Always Being Right</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/the-social-security-fairness-act-was-never-about-fairness/">The Social Security Fairness Act Was Never About Fairness</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/stock-buybacks-are-a-scambut-not-for-the-reason-you-think/">Stock Buybacks Are a Scam—But Not for the Reason You Think</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/panasonics-big-bet-on-kansasa-win-or-a-ticking-time-bomb/">Panasonics Big Bet on Kansas–A Win or a Ticking Time Bomb</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/is-pramila-jayapal-good-for-washington/">Is Pramila Jayapal Good for Washington</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/one-of-the-nine-ways-big-business-avoids-billions-in-taxes-legally/">One of the Nine Ways Big Business Avoids Billions in Taxes Legally</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/mathematics-and-physics-of-light-introduction-to-light/">Mathematics and Physics of Light: Introduction to Light</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-4.3-using-colorrect-for-simple-2d-backgrounds/">Godot 4.3 Using ColorRect for Simple 2D Backgrounds</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/breaking-down-interpolation-lerp/">Breaking Down Interpolation (Lerp)</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-creating-ui-elements/">Godot 43 Creating UI Elements</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-adding-basic-input/">Godot 4.3 Adding Basic Keyboard Input</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-setting-up-a-3d-project-and-skybox-in-visual-studio-code/">Godot 4.3 Set Up a 3D Project, Skybox &amp; Import Your Custom 3d Model from VSC</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/using-python-3-to-convert-webp-to-png/">How to Convert WEBP Files to PNG Using VS Code in Python</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/create-custom-3d-assets-using-ai-mesh-and-blender-for-godot/">Create Custom 3D Assets Using AI Meshy and Blender for Godot</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-understanding-parent-and-child-relationships-through-an-entity-system/">Godot 4.3 Understanding Parent and Child Relationships Through an Entity System</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-moving-get_properties-to-a-separate-class/">Godot 4.3 Moving Get_properties to a Separate Class</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-expanding-object-compatibility-beyond-nodes/">Godot 4.3 Expanding Object Compatibility Beyond Nodes</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/godot-43-basics/">Godot 4.3 Basics</a>
          </li>
        
          <li class="random-article-baseof" style="display: none;">
            <a href="/posts/setting-up-godot-43-for-visual-studio-code/">Setting up Godot 4.3 for Visual Studio Code</a>
          </li>
        
      </ul>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      
      <h1 class="post-title">Optimize Asynchronous Requests Using Asyncio and Aiohttp</h1>
    
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Mar 15, 2025
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          10 min read
        </div>
      </div>
    </header>

    <div class="post-content">
      
        <div class="key-takeaways">
          <h2>Key Takeaways</h2>
          <ul>
            
              <li></li>
            
              <li></li>
            
              <li></li>
            
          </ul>
        </div>
      

      

  
  <p>Imagine you’re a librarian tasked with collecting book details from hundreds of libraries across the country. If you visit each library one by one, waiting for them to hand you the information before moving to the next, it could take days. But what if you could send out assistants to all libraries at once, letting them gather details simultaneously while you sip coffee? That’s the magic of <strong>asynchronous programming</strong>—doing many things at the same time without waiting around. In this tutorial, we’ll explore how to use Python’s <code>asyncio</code> and <code>aiohttp</code> libraries to make fast, efficient web requests, perfect for tasks like fetching stock market data or scraping websites. We’ll build from scratch, explain every concept, and optimize for speed, all while keeping it simple for beginners.</p>
<hr>
<h2 id="section-1-what-are-synchronous-vs-asynchronous-requests">Section 1: What Are Synchronous vs. Asynchronous Requests?</h2>
<h3 id="understanding-the-basics">Understanding the Basics</h3>
<p>When you write a program to fetch data from the internet—like stock prices or ticker lists—it’s like sending a letter and waiting for a reply. In Python, libraries like <code>requests</code> or <code>pandas.read_csv</code> (used for downloading files) handle this in a <strong>synchronous</strong> way. This means:</p>
<ul>
<li><strong>Synchronous</strong>: The program sends a request (e.g., &ldquo;Get me data for stock &lsquo;AAPL&rsquo;&rdquo;), waits for the server to respond, processes the reply, and only then moves to the next request (e.g., &ldquo;Now get &lsquo;GOOG&rsquo;&rdquo;). It’s one task at a time, like waiting in line at the grocery store.</li>
</ul>
<p>For example, if you’re fetching data for 1,000 stocks and each request takes 1 second, it’ll take 1,000 seconds (over 16 minutes) to finish. That’s slow!</p>
<p>Now, picture <strong>asynchronous</strong> requests:</p>
<ul>
<li><strong>Asynchronous</strong>: The program sends all 1,000 requests at once (or in batches), then waits for responses to trickle back in any order. While waiting, it can do other work—like saving data or sending more requests. It’s like hiring 1,000 assistants to fetch data simultaneously. If each request still takes 1 second, but they run concurrently, you might finish in just a few seconds instead of 16 minutes.</li>
</ul>
<h3 id="why-does-this-matter">Why Does This Matter?</h3>
<p>In scenarios like fetching stock tickers or daily price data (OHLCV—Open, High, Low, Close, Volume), you’re dealing with:</p>
<ul>
<li><strong>Many requests</strong>: Hundreds or thousands of stocks.</li>
<li><strong>Network delays</strong>: Servers take time to respond, often 0.1 to 2 seconds per request.</li>
<li><strong>Repetition</strong>: You might need to update this data daily.</li>
</ul>
<p>Synchronous code wastes time waiting, while asynchronous code maximizes efficiency by overlapping these waits.</p>
<h3 id="tools-well-use">Tools We’ll Use</h3>
<ul>
<li><strong><code>asyncio</code></strong>: Python’s built-in library for managing asynchronous tasks. It’s like the conductor of an orchestra, keeping everything in sync without blocking.</li>
<li><strong><code>aiohttp</code></strong>: A library for making asynchronous HTTP requests, replacing <code>requests</code> or <code>pandas.read_csv</code> for web calls. It’s fast and designed for <code>asyncio</code>.</li>
</ul>
<hr>
<h3 id="qa-synchronous-vs-asynchronous">Q&amp;A: Synchronous vs. Asynchronous</h3>
<p><strong>Q: Can’t I just use <code>requests</code>? It’s simpler!</strong><br>
A: Yes, <code>requests</code> is great for small tasks or learning. But for many requests, it’s slow because it waits for each response. Asynchronous tools shine when speed matters.</p>
<p><strong>Q: Does asynchronous mean multithreading?</strong><br>
A: No! Multithreading runs tasks on separate CPU threads, which is complex and overkill for web requests. Asynchronous uses a single thread but juggles tasks efficiently during downtime (like waiting for a server).</p>
<p><strong>Q: Will this work for any website?</strong><br>
A: Mostly, yes, but some servers limit how many requests you can send at once. We’ll cover how to handle that later.</p>
<hr>
<h2 id="section-2-setting-up-your-environment">Section 2: Setting Up Your Environment</h2>
<h3 id="what-youll-need">What You’ll Need</h3>
<p>Before we dive in, let’s set up your tools. Don’t worry if you’ve never done this—it’s like installing apps on your phone.</p>
<ol>
<li>
<p><strong>Python</strong>: You need Python 3.7 or later (3.11 is great as of 2025). Check your version by typing <code>python --version</code> in your terminal (Command Prompt on Windows, Terminal on Mac/Linux). If it’s old or missing, download it from python.org.</p>
</li>
<li>
<p><strong>Virtual Environment</strong>: This keeps your project tidy. In your terminal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python -m venv myenv
</span></span><span style="display:flex;"><span>source myenv/bin/activate  <span style="color:#75715e"># Mac/Linux</span>
</span></span><span style="display:flex;"><span>myenv<span style="color:#ae81ff">\S</span>cripts<span style="color:#ae81ff">\a</span>ctivate     <span style="color:#75715e"># Windows</span>
</span></span></code></pre></div><p>You’ll see <code>(myenv)</code> in your prompt—congrats, you’re in!</p>
</li>
<li>
<p><strong>Install <code>aiohttp</code></strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install aiohttp
</span></span></code></pre></div><p>That’s it! <code>asyncio</code> comes with Python, so no extra install needed.</p>
</li>
</ol>
<h3 id="your-first-synchronous-example">Your First Synchronous Example</h3>
<p>Let’s fetch data synchronously to see the problem. Imagine we’re getting info from a fake stock API:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urls <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://fakeapi.com/stock/AAPL&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://fakeapi.com/stock/GOOG&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://fakeapi.com/stock/MSFT&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> urls:
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)  <span style="color:#75715e"># Waits for each response</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Got data from </span><span style="color:#e6db74">{</span>url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Time taken: </span><span style="color:#e6db74">{</span>time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time<span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds&#34;</span>)
</span></span></code></pre></div><p>If each request takes 1 second, this prints:</p>
<pre tabindex="0"><code>Got data from http://fakeapi.com/stock/AAPL
Got data from http://fakeapi.com/stock/GOOG
Got data from http://fakeapi.com/stock/MSFT
Time taken: 3.01 seconds
</code></pre><p>For 3 stocks, it’s fine. For 1,000? Over 16 minutes! Let’s fix that.</p>
<hr>
<h3 id="qa-setup">Q&amp;A: Setup</h3>
<p><strong>Q: What’s a virtual environment?</strong><br>
A: It’s like a sandbox for your project. It keeps <code>aiohttp</code> separate from other Python projects, avoiding conflicts.</p>
<p><strong>Q: Why not use <code>requests</code> here?</strong><br>
A: We could, but <code>requests</code> is synchronous. We’re building toward <code>aiohttp</code> for speed.</p>
<p><strong>Q: My terminal says ‘pip not found’!</strong><br>
A: Ensure Python is installed correctly. Try <code>python -m ensurepip --upgrade</code> then <code>python -m pip install --upgrade pip</code>.</p>
<hr>
<h2 id="section-3-your-first-asynchronous-request-with-asyncio-and-aiohttp">Section 3: Your First Asynchronous Request with <code>asyncio</code> and <code>aiohttp</code></h2>
<h3 id="writing-asynchronous-code">Writing Asynchronous Code</h3>
<p>Asynchronous code uses special keywords: <code>async</code> and <code>await</code>. Think of them as:</p>
<ul>
<li><strong><code>async</code></strong>: Marks a function as &ldquo;special&rdquo; so it can run asynchronously.</li>
<li><strong><code>await</code></strong>: Pauses the function until a task (like a web request) finishes, but lets other tasks run meanwhile.</li>
</ul>
<p>Here’s how to fetch one stock’s data asynchronously:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> aiohttp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()  <span style="color:#75715e"># Wait for the response, but don’t block others</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> fetch_stock(session, <span style="color:#e6db74">&#34;http://fakeapi.com/stock/AAPL&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Got data: </span><span style="color:#e6db74">{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run the async code</span>
</span></span><span style="display:flex;"><span>asyncio<span style="color:#f92672">.</span>run(main())
</span></span></code></pre></div><h3 id="breaking-it-down-line-by-line"><strong>Breaking It Down (Line by Line)</strong></h3>
<p>This is what each part of the code does:</p>
<ol>
<li><strong>Import required libraries</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> aiohttp  <span style="color:#75715e"># Handles async web requests</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio  <span style="color:#75715e"># Manages async execution</span>
</span></span></code></pre></div><pre><code>- `aiohttp` is used instead of `requests` because it supports async requests.
- `asyncio` controls when async functions start and finish.
</code></pre>
<ol start="2">
<li><strong>Define an async function to fetch stock data</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()
</span></span></code></pre></div><pre><code>- **`async def fetch_stock(...)`** → Marks this function as asynchronous.
- **`async with session.get(url) as response:`** → Makes a non-blocking HTTP request.
- **`await response.text()`** → Waits for the response but **doesn't freeze the program**.
</code></pre>
<ol start="3">
<li><strong>Create an async function to handle multiple requests</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> fetch_stock(session, <span style="color:#e6db74">&#34;http://fakeapi.com/stock/AAPL&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Got data: </span><span style="color:#e6db74">{</span>data<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>- **`async with aiohttp.ClientSession()`** → Creates a session to reuse across multiple requests.
- **`await fetch_stock(...)`** → Fetches stock data **without blocking** other requests.
</code></pre>
<ol start="4">
<li><strong>Start the async event loop</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>asyncio<span style="color:#f92672">.</span>run(main())
</span></span></code></pre></div><pre><code>- **`asyncio.run(main())`** → Starts the async engine and runs `main()`.
</code></pre>
<hr>
<h3 id="qa-first-async-request">Q&amp;A: First Async Request</h3>
<p><strong>Q: Why do I need <code>session</code>?</strong><br>
A: It’s more efficient than making a new connection each time. Think of it as keeping your phone line open for multiple calls.</p>
<p><strong>Q: What does <code>await</code> do exactly?</strong><br>
A: It’s like saying, “I’ll wait here for the answer, but feel free to do other stuff until it’s ready.”</p>
<p><strong>Q: Why <code>asyncio.run()</code>?</strong><br>
A: It’s the magic button to start your async program. Without it, nothing happens!</p>
<hr>
<h2 id="section-4-fetching-multiple-requests-concurrently">Section 4: Fetching Multiple Requests Concurrently</h2>
<h3 id="the-power-of-concurrency">The Power of Concurrency</h3>
<p>Now, let’s fetch data for multiple stocks at once. Here’s the optimized version:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> aiohttp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    urls <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;http://fakeapi.com/stock/AAPL&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;http://fakeapi.com/stock/GOOG&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;http://fakeapi.com/stock/MSFT&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        tasks <span style="color:#f92672">=</span> [fetch_stock(session, url) <span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> urls]  <span style="color:#75715e"># Create tasks</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>gather(<span style="color:#f92672">*</span>tasks)  <span style="color:#75715e"># Run them all at once</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> url, result <span style="color:#f92672">in</span> zip(urls, results):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Got data from </span><span style="color:#e6db74">{</span>url<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>result<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Time taken: </span><span style="color:#e6db74">{</span>time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time<span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>asyncio<span style="color:#f92672">.</span>run(main())
</span></span></code></pre></div><h3 id="whats-happening">What’s Happening?</h3>
<ol>
<li><strong><code>tasks</code></strong>: A list of &ldquo;to-do&rdquo; items. Each calls <code>fetch_stock</code> but doesn’t run yet.</li>
<li><strong><code>asyncio.gather(*tasks)</code></strong>: Runs all tasks concurrently. If each request takes 1 second, this finishes in ~1 second total, not 3!</li>
<li><strong><code>zip(urls, results)</code></strong>: Matches each URL with its response.</li>
</ol>
<p>Output might be:</p>
<pre tabindex="0"><code>Got data from http://fakeapi.com/stock/AAPL: &lt;data&gt;
Got data from http://fakeapi.com/stock/GOOG: &lt;data&gt;
Got data from http://fakeapi.com/stock/MSFT: &lt;data&gt;
Time taken: 1.02 seconds
</code></pre><p>Compare that to 3 seconds synchronously—huge win!</p>
<hr>
<h3 id="qa-concurrency">Q&amp;A: Concurrency</h3>
<p><strong>Q: Why is it faster?</strong><br>
A: Instead of waiting 1 second per request (3 seconds total), it sends all requests at once and waits for the slowest one (1 second).</p>
<p><strong>Q: What’s <code>asyncio.gather</code>?</strong><br>
A: It’s like pressing &ldquo;Go&rdquo; on all your assistants at once, collecting their results when they’re done.</p>
<p><strong>Q: Can I fetch 1,000 URLs like this?</strong><br>
A: Yes, but servers might get mad. We’ll limit that next.</p>
<hr>
<h2 id="section-5-optimizing-with-batches-and-limits">Section 5: Optimizing with Batches and Limits</h2>
<h3 id="why-batch-requests">Why Batch Requests?</h3>
<p>Fetching 1,000 stocks at once might overwhelm the server or your network. Some APIs (like Yahoo Finance) block too many requests, returning errors. Let’s batch them—say, 100 at a time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> aiohttp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_batch</span>(session, urls):
</span></span><span style="display:flex;"><span>    tasks <span style="color:#f92672">=</span> [fetch_stock(session, url) <span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> urls]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>gather(<span style="color:#f92672">*</span>tasks)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    all_urls <span style="color:#f92672">=</span> [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://fakeapi.com/stock/</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)]  <span style="color:#75715e"># 1,000 fake stocks</span>
</span></span><span style="display:flex;"><span>    batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(all_urls), batch_size):
</span></span><span style="display:flex;"><span>            batch_urls <span style="color:#f92672">=</span> all_urls[i:i <span style="color:#f92672">+</span> batch_size]
</span></span><span style="display:flex;"><span>            results <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> fetch_batch(session, batch_urls)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Fetched batch </span><span style="color:#e6db74">{</span>i <span style="color:#f92672">//</span> batch_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>len(results)<span style="color:#e6db74">}</span><span style="color:#e6db74"> stocks&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Time taken: </span><span style="color:#e6db74">{</span>time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time<span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>asyncio<span style="color:#f92672">.</span>run(main())
</span></span></code></pre></div><h3 id="adding-limits-with-semaphore">Adding Limits with Semaphore</h3>
<p>To be extra nice to servers, limit concurrent requests (e.g., 10 at a time):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> aiohttp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url, semaphore):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> semaphore:  <span style="color:#75715e"># Limits concurrency</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    urls <span style="color:#f92672">=</span> [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://fakeapi.com/stock/</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)]
</span></span><span style="display:flex;"><span>    semaphore <span style="color:#f92672">=</span> asyncio<span style="color:#f92672">.</span>Semaphore(<span style="color:#ae81ff">10</span>)  <span style="color:#75715e"># Max 10 requests at once</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        tasks <span style="color:#f92672">=</span> [fetch_stock(session, url, semaphore) <span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> urls]
</span></span><span style="display:flex;"><span>        results <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>gather(<span style="color:#f92672">*</span>tasks)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Fetched </span><span style="color:#e6db74">{</span>len(results)<span style="color:#e6db74">}</span><span style="color:#e6db74"> stocks&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Time taken: </span><span style="color:#e6db74">{</span>time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time<span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>asyncio<span style="color:#f92672">.</span>run(main())
</span></span></code></pre></div><h3 id="explanation">Explanation</h3>
<ul>
<li><strong>Batches</strong>: Splits 1,000 into chunks of 100, fetching each chunk concurrently.</li>
<li><strong>Semaphore</strong>: Caps simultaneous requests at 10, even within batches, preventing overload.</li>
</ul>
<p>For 1,000 requests at 1 second each:</p>
<ul>
<li>Synchronous: 1,000 seconds (16+ minutes).</li>
<li>Batches of 100: ~10 seconds (10 batches x 1 second).</li>
<li>Semaphore of 10: ~100 seconds (1,000 / 10), but safer.</li>
</ul>
<hr>
<h3 id="qa-optimization">Q&amp;A: Optimization</h3>
<p><strong>Q: Why not fetch all 1,000 at once?</strong><br>
A: Servers might block you, or your network could crash. Batches and limits balance speed and stability.</p>
<p><strong>Q: What’s a semaphore?</strong><br>
A: It’s like a ticket system—only 10 people can enter the store at once, even if 1,000 are waiting.</p>
<p><strong>Q: How do I pick a batch size?</strong><br>
A: Test! Start with 50-100, adjust based on errors or speed.</p>
<hr>
<h2 id="section-6-handling-errors-and-real-world-use">Section 6: Handling Errors and Real-World Use</h2>
<h3 id="error-handling">Error Handling</h3>
<p>Servers fail. Let’s catch errors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_stock</span>(session, url, semaphore):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> semaphore:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> session<span style="color:#f92672">.</span>get(url) <span style="color:#66d9ef">as</span> response:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> response<span style="color:#f92672">.</span>text()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error </span><span style="color:#e6db74">{</span>response<span style="color:#f92672">.</span>status<span style="color:#e6db74">}</span><span style="color:#e6db74"> for </span><span style="color:#e6db74">{</span>url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Failed </span><span style="color:#e6db74">{</span>url<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    urls <span style="color:#f92672">=</span> [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;http://fakeapi.com/stock/</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)]
</span></span><span style="display:flex;"><span>    semaphore <span style="color:#f92672">=</span> asyncio<span style="color:#f92672">.</span>Semaphore(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> aiohttp<span style="color:#f92672">.</span>ClientSession() <span style="color:#66d9ef">as</span> session:
</span></span><span style="display:flex;"><span>        tasks <span style="color:#f92672">=</span> [fetch_stock(session, url, semaphore) <span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> urls]
</span></span><span style="display:flex;"><span>        results <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>gather(<span style="color:#f92672">*</span>tasks)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    valid_results <span style="color:#f92672">=</span> [r <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> results <span style="color:#66d9ef">if</span> r <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Fetched </span><span style="color:#e6db74">{</span>len(valid_results)<span style="color:#e6db74">}</span><span style="color:#e6db74"> valid stocks&#34;</span>)
</span></span></code></pre></div><h3 id="real-world-scenario">Real-World Scenario</h3>
<p>For stock data (like OHLCV), replace the fake URL with a real API or adapt for file downloads (e.g., FTP). The principles stay the same—batch, limit, handle errors.</p>
<hr>
<h3 id="qa-errors">Q&amp;A: Errors</h3>
<p><strong>Q: What if all requests fail?</strong><br>
A: Check your URL or internet. The script still runs, just with <code>None</code> results.</p>
<p><strong>Q: Can I retry failed requests?</strong><br>
A: Yes! Add a loop in <code>fetch_stock</code> to retry up to 3 times.</p>
<p><strong>Q: Is this legal for stock APIs?</strong><br>
A: Check the API’s terms (e.g., Yahoo Finance’s). Respect rate limits!</p>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>You’ve learned:</p>
<ul>
<li>Synchronous waits, asynchronous wins.</li>
<li><code>asyncio</code> and <code>aiohttp</code> basics.</li>
<li>Concurrency with <code>gather</code>, batches, and semaphores.</li>
<li>Error handling for robustness.</li>
</ul>
<p>For a beginner, start small—fetch 5 URLs, then scale up. Soon, you’ll be fetching thousands of stock prices in seconds, not hours. Happy coding!</p>


    </div>

    <div class="post-footer">
      
    </div>
  </article>

    </main>
    <script src="/js/theme-toggle.js"></script>
  </body>
</html>
